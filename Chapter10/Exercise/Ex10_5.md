

### Exercise 10.5

 Implement a torque generator that tries to rotate its object into a particular orienta tion. This is the rotational equivalent of a spring: it has a rest orientation and uses torques to return the object to that orientation



### Solution

I implemented it in **Unreal Engine 5.3**. The gif below visualizes the experiment result.

Please refer to `RestOrientationKeeper.h` and `RestOrientationKeeper.cpp`.

I put one rest orientation keeper with one from ex10.4

![ex105](assets/ex105.gif)

### Key formulas and implementation overview

**Pseudocode**

```
Function ApplyTorque(DeltaTime):
    // Compute the angular difference between current and rest orientations
    DeltaRotation = Inverse(CurrentOrientation) * RestOrientation

    // Convert the quaternion difference to Euler angles
    RotationAxis, RotationAngle = ToAxisAndAngle(DeltaRotation)

    // Calculate the spring torque based on angular displacement
    SpringTorque = RotationAxis * RotationAngle * SpringConstant

    // Get current angular velocity for damping
    CurrentAngularVelocity = GetPhysicsAngularVelocityInDegrees()

    // Calculate the damping torque to oppose angular velocity
    DampingTorque = -CurrentAngularVelocity * DumpConstant

    // Combine spring and damping torque
    TotalTorque = SpringTorque + DampingTorque

    // Apply the total torque to the object
    ApplyTorqueToObject(RootComponent, TotalTorque)

    // Optionally stop torque when near target orientation
    If RotationAngle < 0.01:
        SetPhysicsAngularVelocityInDegrees(ZeroVector)
```

**Quaternions and Angular Displacement**:
 The angular difference between the current orientation and the rest orientation is calculated using quaternion operations:

$$
\text{DeltaRotation} = \mathbf{q}_{\text{current}}^{-1} \times \mathbf{q}_{\text{rest}}
$$

where:

- $\mathbf{q}_{\text{current}}$ is the current orientation quaternion.
- $\mathbf{q}_{\text{rest}}$ is the target (rest) orientation quaternion.
- The inverse of the current orientation is multiplied by the rest orientation to find the relative rotation.

**Spring Torque**:
 The spring torque, which tries to restore the object to its rest orientation, is calculated as:

$$
\mathbf{T}_{\text{spring}} = \mathbf{R} \times \theta \times k_s
$$

where:

- $\mathbf{R}$ is the rotation axis.
- $\theta$ is the angular displacement.
- $k_s$ is the spring constant, determining how strong the restoring force is.

**Damping Torque**:
 The damping torque is calculated to oppose the current angular velocity and slow down the rotation:

$$
\mathbf{T}_{\text{damping}} = -\mathbf{v}_{\text{angular}} \times k_d
$$

where:

- $\mathbf{v}_{\text{angular}}$ is the current angular velocity.
- $k_d$ is the damping constant.

**Final Torque**:
 The total torque applied to the object is the sum of the spring and damping torques:

$$
\mathbf{T}_{\text{total}} = \mathbf{T}_{\text{spring}} + \mathbf{T}_{\text{damping}}
$$


### Parameter setup

| **Parameter**            | **Description**                                              | **Semantics**                                                |
| ------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| `RestOrientation`        | The desired rest orientation the object should achieve.      | Specifies the orientation that the object should return to.  |
| `SpringConstant`         | The strength of the spring force restoring the object.       | Controls how strongly the object is pulled back to the rest orientation. |
| `DampingConstant`        | The constant used for damping the angular velocity.          | Determines how much the torque reduces the object’s angular velocity over time. |
| `CurrentOrientation`     | The current orientation of the object.                       | The object’s current rotation, updated each frame.           |
| `CurrentAngularVelocity` | The current angular velocity of the object (calculated at runtime). | Represents how fast the object is rotating.                  |

### Experiment setup

1. I applied the torque to a green cuboid actor with scale `(5, 0.2, 3)`, with its position and rotation locked.
2. For parameters defined in `RestOrientationKeeper.h`:
   1. The rest orientation is set to `TargetOrientation = (0, 0, 0, 1)` (identity quaternion).
   2. The spring constant is set to `SpringConstant = 500.0f`.
   3. The damping constant is set to `DampingConstant = 2.0f`.

The object is smoothly restored to the rest orientation, with torque diminishing as it approaches the target.